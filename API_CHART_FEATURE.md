# 首页API调用统计图表功能说明

## 功能概述

为项目首页（Dashboard）添加了API调用统计功能，包括：
1. 欢迎卡片中的API调用统计数字
2. 最近7天API调用趋势折线图

## 新增功能

### 1. API调用统计数字

在欢迎卡片中新增了两个统计指标：
- **今日API调用**: 显示当天的API调用次数
- **总API调用**: 显示系统累计的API调用次数

#### 数据来源
- 后端接口: `GET /logs/statistics`
- 数据字段:
  - `today_count`: 今日调用次数
  - `total`: 总调用次数
  - `success_count`: 成功调用次数
  - `fail_count`: 失败调用次数

### 2. API调用趋势图表

新增了一个折线图，展示最近7天的API调用趋势，包含三条曲线：
- **总调用** (蓝色): 每天的总API调用次数
- **成功** (绿色): 成功的API调用次数
- **失败** (红色): 失败的API调用次数

#### 图表特性
- ✅ 平滑曲线显示
- ✅ 区域渐变填充
- ✅ 图例说明
- ✅ 鼠标悬停提示
- ✅ 响应式设计
- ✅ 窗口大小自适应

#### 数据统计逻辑
```javascript
// 按日期统计API调用数量
- 获取最近7天的日期
- 统计每天的总调用、成功、失败次数
- 按日期生成三条曲线的数据
```

## 技术实现

### 1. 前端实现

#### 新增状态变量
```javascript
// API调用图表容器
const apiChartContainer = ref(null)
let apiChartInstance = null

// 统计数据
const stats = reactive({
  totalApiCalls: 0,      // 总API调用
  todayApiCalls: 0,      // 今日API调用
  successApiCalls: 0,    // 成功调用
  failApiCalls: 0        // 失败调用
})
```

#### 新增方法
- `loadApiChartData()`: 加载API调用图表数据
- `initApiChart(logs)`: 初始化API调用折线图

#### 图表配置
```javascript
{
  tooltip: {
    trigger: 'axis',
    axisPointer: { type: 'cross' }
  },
  legend: {
    data: ['总调用', '成功', '失败']
  },
  series: [
    {
      name: '总调用',
      type: 'line',
      smooth: true,
      color: '#409eff',
      areaStyle: { /* 渐变填充 */ }
    },
    {
      name: '成功',
      type: 'line',
      smooth: true,
      color: '#67c23a',
      areaStyle: { /* 渐变填充 */ }
    },
    {
      name: '失败',
      type: 'line',
      smooth: true,
      color: '#f56c6c',
      areaStyle: { /* 渐变填充 */ }
    }
  ]
}
```

### 2. 后端接口

#### 日志统计接口
- **路径**: `GET /logs/statistics`
- **权限**: `@jwt_required()`
- **返回数据**:
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "total": 1234,           // 总日志数
    "today_count": 56,       // 今日日志数
    "success_count": 1100,   // 成功数
    "fail_count": 134,       // 失败数
    "action_stats": [        // 按操作类型统计
      { "action": "create", "count": 100 },
      { "action": "update", "count": 200 }
    ],
    "module_stats": [        // 按模块统计
      { "module": "testcase", "count": 300 },
      { "module": "user", "count": 100 }
    ]
  }
}
```

## 文件修改清单

### 修改的文件

1. **`vue_web/src/views/DashboardView.vue`**
   - ✅ 导入 `logApi` 和 `DataLine` 图标
   - ✅ 新增 `apiChartContainer` 和 `apiChartInstance` 状态
   - ✅ 新增API调用统计字段
   - ✅ 新增 `loadApiChartData()` 方法
   - ✅ 新增 `initApiChart()` 方法
   - ✅ 更新欢迎卡片，添加API调用统计
   - ✅ 新增API调用趋势图表卡片
   - ✅ 更新样式，支持新增的统计项和图表

## 功能展示

### 首页布局

```
┌─────────────────────────────────────────────────┐
│  欢迎回来，用户！                                │
│  今天是 2025年1月25日 星期六                    │
│                                                 │
│  测试用例  需求文档  待执行  AI生成  今日API  总API│
│    100       50       20      30       56     1234 │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│  快捷入口                                      │
│  [测试用例] [生成用例] [需求管理] [提示词管理]   │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│  最近7天用例趋势                                │
│  [折线图]                                       │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│  最近7天API调用趋势    [成功: 1100] [失败: 134] │
│  [三条折线图: 总调用/成功/失败]                  │
└─────────────────────────────────────────────────┘

┌──────────────────────┬──────────────────────────┐
│  最近用例             │  最近需求                │
│  [用例列表]           │  [需求列表]              │
└──────────────────────┴──────────────────────────┘
```

## 数据流程

### 数据加载流程
```
1. 组件挂载 (onMounted)
   ↓
2. 加载用户快捷入口设置
   ↓
3. 并行加载数据
   ├─ 测试用例统计
   ├─ 最近测试用例
   ├─ 需求列表
   └─ 日志统计 ← 新增
   ↓
4. 更新统计数据
   ├─ 测试用例数据
   ├─ 需求数据
   └─ API调用数据 ← 新增
   ↓
5. 加载图表数据
   ├─ 用例趋势图
   └─ API调用趋势图 ← 新增
   ↓
6. 初始化图表
   ├─ 用例折线图
   └─ API调用折线图 ← 新增
```

## 图表说明

### 用例趋势图
- **类型**: 单条折线图
- **颜色**: 蓝色 (#409eff)
- **数据**: 最近7天新增用例数量

### API调用趋势图
- **类型**: 多条折线图（3条）
- **颜色**:
  - 总调用: 蓝色 (#409eff)
  - 成功: 绿色 (#67c23a)
  - 失败: 红色 (#f56c6c)
- **数据**: 最近7天API调用统计

## 优势特点

### 1. 实时性
- 数据实时从后端获取
- 每次访问首页都加载最新数据

### 2. 可视化
- 直观的折线图展示趋势
- 不同颜色区分成功/失败状态
- 鼠标悬停显示详细数据

### 3. 响应式
- 图表自适应窗口大小
- 统计卡片支持换行显示

### 4. 性能优化
- 使用 ECharts 图表库
- 图表实例销毁重建机制
- 窗口 resize 事件监听

## 后续优化建议

1. **时间范围选择**
   - 支持选择不同时间范围（7天/30天/90天）
   - 自定义日期范围选择

2. **图表交互**
   - 点击图表跳转到日志详情页
   - 支持图表数据导出

3. **更多统计维度**
   - 按模块统计API调用
   - 按用户统计API调用
   - 响应时间分布图

4. **实时更新**
   - WebSocket 实时推送数据
   - 定时自动刷新

5. **异常提醒**
   - API失败率过高时提醒
   - 调用量异常增长提醒

## 兼容性

- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

## 更新记录

- **2025-01-25**: 初始版本发布
  - 添加API调用统计数字
  - 添加API调用趋势折线图
  - 集成日志统计接口
